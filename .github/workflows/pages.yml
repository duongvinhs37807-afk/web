name: Docs Portal — Build & Deploy (Jekyll from nested source)

on:
 push:
  branches: [main]
  paths:
   - 'web-foundations/**'
   - '_layouts/**'
   - '_includes/**'
   - 'assets/**'
   - '.github/workflows/pages.yml'
 workflow_dispatch:

permissions:
 contents: read
 pages: write
 id-token: write

concurrency:
 group: 'pages'
 cancel-in-progress: true

env:
 JEKYLL_ENV: production
 SITE_SOURCE: web-foundations/docs # <— nested source

jobs:
 build:
  runs-on: ubuntu-latest
  steps:
   - uses: actions/checkout@v4

   - uses: ruby/setup-ruby@v1
     with: { ruby-version: '3.2', bundler-cache: true }

   - name: Install Jekyll deps
     run: |
      if [ -f Gemfile ]; then bundle install --path vendor/bundle; fi

   - name: Build site (from nested source)
     run: |
      bundle exec jekyll build --source "$SITE_SOURCE" --trace

   - name: Upload Pages artifact
     uses: actions/upload-pages-artifact@v3
     with:
      path: _site

 deploy:
  needs: build
  runs-on: ubuntu-latest
  environment:
   name: github-pages
   url: ${{ steps.deployment.outputs.page_url }}
  steps:
   - id: deployment
     uses: actions/deploy-pages@v4
